<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EchoScribe ‚Äî AI Summary Readout</title>
    <meta name="description" content="AI-generated clinical SOAP / mentoring GROW note and analysis." />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="card.css" />
    <link rel="stylesheet" href="modal.css" />
    <!-- Global Mode Script -->
    <script src="mode.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="bg-blobs">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <main class="container summary-container">
        <!-- Navigation -->
        <div class="summary-nav">
            <a href="/record.html" class="back-link" id="back-link">
                <span>‚Üê</span>
                <span>Back to Recorder</span>
            </a>
            <div class="header-actions" style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                <button id="theme-toggle" class="btn btn-icon-only" title="Toggle Theme">üåô</button>
                <a href="/dashboard.html" class="btn btn-secondary btn-sm">üìä Dashboard</a>
                <a id="btn-insights" href="#" class="btn btn-secondary btn-sm" title="View Patient Insights"
                    style="display:none;">üìà Insights</a>
                <button id="btn-logout" class="btn btn-secondary btn-sm">üö™ Logout</button>
            </div>
        </div>

        <header class="summary-header">
            <span class="summary-page-icon">ü©∫</span>
            <h1 class="summary-page-title" id="page-title">Clinical SOAP Note</h1>
            <p class="summary-page-subtitle">AI-powered analysis by EchoScribe</p>
        </header>

        <!-- Risk Badge -->
        <div class="risk-banner" id="risk-banner" style="display: none;">
            <span class="risk-icon" id="risk-icon">‚ö†Ô∏è</span>
            <span class="risk-text" id="risk-text">Risk assessment pending</span>
        </div>

        <!-- Confidence Score -->
        <div class="confidence-bar" id="confidence-bar">
            <span class="confidence-label">AI Confidence:</span>
            <div class="confidence-track">
                <div class="confidence-fill" id="confidence-fill" style="width: 0%"></div>
            </div>
            <span class="confidence-value" id="confidence-value">‚Äî%</span>
        </div>

        <!-- Counseling / Mentee Card -->
        <div class="counseling-card-container">
            <div class="counseling-card">
                <div class="card-header">
                    <span class="card-name" id="card-name">Unknown</span>
                    <span class="card-hp">LVL <span id="card-lvl">1</span></span>
                </div>
                <div class="card-image-frame">
                    <span class="card-avatar" id="card-avatar">üë§</span>
                </div>
                <div class="card-stats">
                    <div class="stat-row">
                        <span class="stat-label" id="label-problem">Problem</span>
                        <span class="stat-text" id="card-problem">Analyzing...</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label" id="label-reason">Goal/Reason</span>
                        <span class="stat-text" id="card-reason">Analyzing...</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Progress</span>
                        <span class="stat-text" id="card-progress">Analyzing...</span>
                    </div>
                    <div class="stat-row" style="margin-top: 5px;">
                        <span class="stat-label">Mood</span>
                        <span class="emotion-pill" id="card-mood">Neutral</span>
                    </div>
                </div>
                <div class="card-footer" id="card-footer">"Every step forward is a victory."</div>
            </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar" id="stats-bar">
            <div class="stat-item">
                <span class="stat-value" id="stat-words">‚Äî</span>
                <span class="stat-label">Words</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <span class="stat-value" id="stat-duration">‚Äî</span>
                <span class="stat-label">Est. Duration</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <span class="stat-value" id="stat-topics">‚Äî</span>
                <span class="stat-label">Topics</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <span class="stat-badge" id="stat-sentiment">‚Äî</span>
                <span class="stat-label">Tone</span>
            </div>
        </div>

        <!-- ===================== -->
        <!-- THERAPY: SOAP Sections -->
        <!-- ===================== -->
        <div id="soap-section">
            <div class="soap-grid">
                <div class="summary-card soap-card">
                    <div class="summary-card-accent accent-soap-s"></div>
                    <div class="summary-card-content">
                        <h2 class="summary-card-title"><span class="card-icon soap-letter">S</span> Subjective <span
                                style="font-size:0.8rem; font-weight:normal; color:#8892b0; margin-left:auto;">‚úèÔ∏è
                                Edit</span></h2>
                        <div class="summary-text editable" id="soap-subjective" contenteditable="true"
                            style="outline:none; padding: 0.5rem; background: rgba(0,0,0,0.15); border: 1px dashed rgba(108,99,255,0.2); border-radius: 8px; min-height: 50px;">
                            Loading...</div>
                    </div>
                </div>
                <div class="summary-card soap-card">
                    <div class="summary-card-accent accent-soap-o"></div>
                    <div class="summary-card-content">
                        <h2 class="summary-card-title"><span class="card-icon soap-letter">O</span> Objective <span
                                style="font-size:0.8rem; font-weight:normal; color:#8892b0; margin-left:auto;">‚úèÔ∏è
                                Edit</span></h2>
                        <div class="summary-text editable" id="soap-objective" contenteditable="true"
                            style="outline:none; padding: 0.5rem; background: rgba(0,0,0,0.15); border: 1px dashed rgba(108,99,255,0.2); border-radius: 8px; min-height: 50px;">
                            Loading...</div>
                    </div>
                </div>
                <div class="summary-card soap-card">
                    <div class="summary-card-accent accent-soap-a"></div>
                    <div class="summary-card-content">
                        <h2 class="summary-card-title"><span class="card-icon soap-letter">A</span> Assessment <span
                                style="font-size:0.8rem; font-weight:normal; color:#8892b0; margin-left:auto;">‚úèÔ∏è
                                Edit</span></h2>
                        <div class="summary-text editable" id="soap-assessment" contenteditable="true"
                            style="outline:none; padding: 0.5rem; background: rgba(0,0,0,0.15); border: 1px dashed rgba(108,99,255,0.2); border-radius: 8px; min-height: 50px;">
                            Loading...</div>
                    </div>
                </div>
                <div class="summary-card soap-card">
                    <div class="summary-card-accent accent-soap-p"></div>
                    <div class="summary-card-content">
                        <h2 class="summary-card-title"><span class="card-icon soap-letter">P</span> Plan <span
                                style="font-size:0.8rem; font-weight:normal; color:#8892b0; margin-left:auto;">‚úèÔ∏è
                                Edit</span></h2>
                        <div class="summary-text editable" id="soap-plan" contenteditable="true"
                            style="outline:none; padding: 0.5rem; background: rgba(0,0,0,0.15); border: 1px dashed rgba(108,99,255,0.2); border-radius: 8px; min-height: 50px;">
                            Loading...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== -->
        <!-- MENTORING: GROW Sections -->
        <!-- ===================== -->
        <div id="grow-section" style="display:none;">
            <div class="soap-grid">
                <div class="summary-card soap-card">
                    <div class="summary-card-accent accent-soap-s"></div>
                    <div class="summary-card-content">
                        <h2 class="summary-card-title"><span class="card-icon soap-letter">G</span> Goal <span
                                style="font-size:0.8rem; font-weight:normal; color:#8892b0; margin-left:auto;">‚úèÔ∏è
                                Edit</span></h2>
                        <div class="summary-text editable" id="grow-goal" contenteditable="true"
                            style="outline:none; padding: 0.5rem; background: rgba(0,0,0,0.15); border: 1px dashed rgba(108,99,255,0.2); border-radius: 8px; min-height: 50px;">
                            Loading...</div>
                    </div>
                </div>
                <div class="summary-card soap-card">
                    <div class="summary-card-accent accent-soap-o"></div>
                    <div class="summary-card-content">
                        <h2 class="summary-card-title"><span class="card-icon soap-letter">R</span> Reality <span
                                style="font-size:0.8rem; font-weight:normal; color:#8892b0; margin-left:auto;">‚úèÔ∏è
                                Edit</span></h2>
                        <div class="summary-text editable" id="grow-reality" contenteditable="true"
                            style="outline:none; padding: 0.5rem; background: rgba(0,0,0,0.15); border: 1px dashed rgba(108,99,255,0.2); border-radius: 8px; min-height: 50px;">
                            Loading...</div>
                    </div>
                </div>
                <div class="summary-card soap-card">
                    <div class="summary-card-accent accent-soap-a"></div>
                    <div class="summary-card-content">
                        <h2 class="summary-card-title"><span class="card-icon soap-letter">O</span> Options <span
                                style="font-size:0.8rem; font-weight:normal; color:#8892b0; margin-left:auto;">‚úèÔ∏è
                                Edit</span></h2>
                        <div class="summary-text editable" id="grow-options" contenteditable="true"
                            style="outline:none; padding: 0.5rem; background: rgba(0,0,0,0.15); border: 1px dashed rgba(108,99,255,0.2); border-radius: 8px; min-height: 50px;">
                            Loading...</div>
                    </div>
                </div>
                <div class="summary-card soap-card">
                    <div class="summary-card-accent accent-soap-p"></div>
                    <div class="summary-card-content">
                        <h2 class="summary-card-title"><span class="card-icon soap-letter">W</span> Way Forward <span
                                style="font-size:0.8rem; font-weight:normal; color:#8892b0; margin-left:auto;">‚úèÔ∏è
                                Edit</span></h2>
                        <div class="summary-text editable" id="grow-wayforward" contenteditable="true"
                            style="outline:none; padding: 0.5rem; background: rgba(0,0,0,0.15); border: 1px dashed rgba(108,99,255,0.2); border-radius: 8px; min-height: 50px;">
                            Loading...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Risk Assessment Card -->
        <div class="summary-card" id="risk-card">
            <div class="summary-card-accent accent-pink"></div>
            <div class="summary-card-content">
                <h2 class="summary-card-title"><span class="card-icon">üõ°Ô∏è</span> Risk Assessment</h2>
                <div class="risk-details">
                    <div class="risk-row" id="risk-row-si">
                        <span id="risk-label-1">Suicidal Ideation:</span>
                        <span class="risk-badge" id="risk-si">No</span>
                    </div>
                    <div class="risk-row" id="risk-row-sh">
                        <span id="risk-label-2">Self-Harm Risk:</span>
                        <span class="risk-badge" id="risk-sh-level">Low</span>
                    </div>
                    <p class="risk-notes" id="risk-notes">No risk factors identified.</p>
                </div>
            </div>
        </div>

        <!-- Auto-Booking Card -->
        <div class="summary-card" id="booking-card">
            <div class="summary-card-accent" style="background: linear-gradient(to bottom, #805ad5, #553c9a);"></div>
            <div class="summary-card-content">
                <h2 class="summary-card-title"><span class="card-icon">üìÖ</span> Auto-Booking Follow-Up</h2>
                <div class="risk-details">
                    <div class="risk-row">
                        <span>Follow-up Needed:</span>
                        <span class="risk-badge" id="booking-needed">No</span>
                    </div>
                    <div class="risk-row">
                        <span>Suggested Timeframe:</span>
                        <span style="color:#e0e6ed; font-weight:500;" id="booking-timeframe">None</span>
                    </div>
                    <p class="risk-notes" id="booking-reason">No follow-up discussed.</p>
                </div>
                <div style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-direction: column;">
                    <button class="btn btn-sm" id="btn-create-booking"
                        style="background:#805ad5; color:#fff; width:100%; border-radius:6px; display:none;">Schedule
                        It</button>
                    <button class="btn btn-sm" id="btn-reschedule-booking"
                        style="background:rgba(255,255,255,0.1); color:#fff; width:100%; border-radius:6px; display:none;">Reschedule
                        / Manage</button>
                </div>
            </div>
        </div>

        <!-- Referral Card -->
        <div class="summary-card" id="referral-card">
            <div class="summary-card-accent" style="background: linear-gradient(to bottom, #ed64a6, #b83280);"></div>
            <div class="summary-card-content">
                <h2 class="summary-card-title"><span class="card-icon">ü§ù</span> Referral</h2>
                <div class="risk-details">
                    <div class="risk-row">
                        <span>Referral Needed:</span>
                        <span class="risk-badge" id="referral-needed">No</span>
                    </div>
                    <div class="risk-row">
                        <span>Specialty:</span>
                        <span style="color:#e0e6ed; font-weight:500;" id="referral-specialty">None</span>
                    </div>
                    <p class="risk-notes" id="referral-reason">No referral necessary.</p>
                </div>
                <div style="margin-top: 1rem;">
                    <button class="btn btn-sm" id="btn-create-referral"
                        style="background:#ed64a6; color:#fff; width:100%; border-radius:6px; display:none;">Generate
                        Referral Form</button>
                </div>
            </div>
        </div>

        <!-- Diagnostic Impressions (Therapy) / Skill Progression (Mentoring) -->
        <div class="summary-card" id="diagnostic-card">
            <div class="summary-card-accent accent-blue"></div>
            <div class="summary-card-content">
                <h2 class="summary-card-title"><span class="card-icon">üî¨</span> <span id="diagnostic-title">Diagnostic
                        Impressions</span></h2>
                <ul class="key-points-list" id="diagnostic-list">
                    <li>Loading...</li>
                </ul>
            </div>
        </div>

        <!-- Interventions Used (Therapy) / Skills Working On (Mentoring) -->
        <div class="summary-card" id="interventions-card">
            <div class="summary-card-accent accent-green"></div>
            <div class="summary-card-content">
                <h2 class="summary-card-title"><span class="card-icon">üß∞</span> <span
                        id="interventions-title">Interventions Used</span></h2>
                <div class="topics-pills" id="interventions-pills"></div>
            </div>
        </div>

        <!-- Medication Changes (Therapy only) -->
        <div class="summary-card" id="medication-card">
            <div class="summary-card-accent" style="background: linear-gradient(to bottom, #f6ad55, #ed8936);"></div>
            <div class="summary-card-content">
                <h2 class="summary-card-title"><span class="card-icon">üíä</span> Medication Changes</h2>
                <ul class="key-points-list" id="medication-list">
                    <li>None recorded</li>
                </ul>
            </div>
        </div>

        <!-- Progress Indicators (Therapy) / Action Items (Mentoring) -->
        <div class="summary-card" id="progress-card">
            <div class="summary-card-accent" style="background: linear-gradient(to bottom, #4fd1c5, #38b2ac);"></div>
            <div class="summary-card-content">
                <h2 class="summary-card-title"><span class="card-icon">üìà</span> <span id="progress-title">Progress
                        Indicators</span></h2>
                <ul class="key-points-list" id="progress-list">
                    <li>Loading...</li>
                </ul>
            </div>
        </div>

        <!-- Visual Insights (Charts) -->
        <div class="charts-grid">
            <div class="chart-container">
                <h3 style="color:#e0e6ed; margin-bottom:1rem; font-size:1rem;">Topic Distribution</h3>
                <canvas id="topicsChart"></canvas>
            </div>
            <div class="chart-container">
                <h3 style="color:#e0e6ed; margin-bottom:1rem; font-size:1rem;" id="composition-title">Session
                    Composition</h3>
                <canvas id="sentimentChart"></canvas>
            </div>
        </div>

        <!-- Patient Communication Card -->
        <div class="summary-card" style="grid-column: 1 / -1; margin-top: 1.5rem; max-width: 100%;">
            <div class="summary-card-accent" style="background: linear-gradient(to bottom, #4299e1, #2b6cb0);"></div>
            <div class="summary-card-content">
                <h2 class="summary-card-title"><span class="card-icon">‚úâÔ∏è</span> Multilingual Instructions</h2>
                <div style="display:flex; flex-direction:column; gap:1rem; margin-top: 1rem;">
                    <div>
                        <span
                            style="font-size:0.8rem; color:#8892b0; text-transform:uppercase; letter-spacing:1px; font-weight:bold;">English</span>
                        <p id="comm-english"
                            style="color:#e0e6ed; padding: 0.75rem; background: rgba(0,0,0,0.15); border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); margin-top:0.5rem;">
                            None generated.</p>
                    </div>
                    <div>
                        <span
                            style="font-size:0.8rem; color:#8892b0; text-transform:uppercase; letter-spacing:1px; font-weight:bold;">Translated
                            (Native Language)</span>
                        <p id="comm-translated"
                            style="color:#e0e6ed; padding: 0.75rem; background: rgba(0,0,0,0.15); border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); margin-top:0.5rem;">
                            None generated.</p>
                    </div>
                    <button class="btn btn-sm" id="btn-send-patient-instructions"
                        style="align-self: flex-start; background: #2b6cb0; color: #fff; display:none;">Send to
                        Patient</button>
                </div>
            </div>
        </div>

        <!-- Topics -->
        <div class="topics-section" id="topics-section" style="display: none;">
            <h2 class="summary-card-title">
                <span class="card-icon">üè∑Ô∏è</span> Topics Detected
            </h2>
            <div class="topics-pills" id="topics-pills"></div>
        </div>

        <!-- Original Transcript (collapsible) -->
        <details class="original-transcript-details">
            <summary class="original-transcript-toggle">
                <span class="card-icon">üìÑ</span> View Original Transcript
            </summary>
            <div class="original-transcript-box" id="original-transcript">Loading...</div>
        </details>

        <!-- Actions -->
        <div class="summary-actions">
            <button id="btn-save" class="btn btn-save" title="Save Session" style="background: #2b6cb0;">
                <span class="btn-icon">üíæ</span>
                <span>Save Session</span>
            </button>
            <button id="btn-export-pdf" class="btn" title="Export PDF" style="background: #c53030;">
                <span class="btn-icon">üìÑ</span>
                <span>Export PDF</span>
            </button>
            <button id="btn-copy-summary" class="btn btn-summarize" title="Copy Note">
                <span class="btn-icon">üìã</span>
                <span id="copy-label">Copy SOAP</span>
            </button>
            <a href="/record.html" class="btn btn-record" title="New Recording" style="text-decoration:none;">
                <span class="btn-icon">üé§</span>
                <span>New Recording</span>
            </a>
        </div>

        <!-- History & Profile Section -->
        <div class="history-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h2 class="summary-card-title" style="margin:0;">üìú Session History</h2>
                <div style="display:flex; gap:0.5rem;">
                    <button id="btn-export-csv" class="btn"
                        style="font-size:0.8rem; padding:0.4rem 0.8rem; background:#38a169; color:#fff;">
                        Export CSV
                    </button>
                    <button id="btn-export-json" class="btn"
                        style="font-size:0.8rem; padding:0.4rem 0.8rem; background:#2b6cb0; color:#fff;">
                        Export JSON
                    </button>
                    <button id="btn-analyze-profile" class="btn"
                        style="font-size:0.8rem; padding:0.4rem 0.8rem; background:#4fd1c5; color:#1a202c;">
                        Analyze Profile
                    </button>
                </div>
            </div>
            <div id="history-list">
                <p style="color:#718096; font-style:italic;">No history loaded.</p>
            </div>
        </div>

        <!-- Profile Modal -->
        <div class="modal-overlay" id="profile-modal">
            <div class="modal">
                <div class="modal-header">
                    <span class="modal-title">üìä Intelligence Profile</span>
                    <button class="modal-close" id="modal-close">‚úï</button>
                </div>
                <div id="modal-content">
                    <p style="color:#718096;">Loading profile analysis...</p>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div id="toast" class="toast" style="display: none;">
            <span id="toast-message"></span>
        </div>

        <footer class="footer">
            <p>EchoScribe ‚Äî AI-assisted documentation. This is not a substitute for clinical judgment.</p>
        </footer>
    </main>

    <script src="auth-guard.js"></script>
    <script src="summary.js"></script>
</body>

</html>